name: 'retendo-network'
services:

  nginx:
    image: nginx:mainline-alpine
    restart: no
    ports:
      - "80:80"
    volumes:
      - type: bind
        source: ./config/nginx.conf
        target: /etc/nginx/nginx.conf
        read_only: true
      - type: bind
        source: ./config/nginx
        target: /etc/nginx/conf.d/
        read_only: true
    networks:
      default:
      internal:

  boss:
    image: node:18-alpine
    restart: no
    working_dir: /app
    volumes:
      - ./repos/BOSS:/app 
      - /app/node_modules
    ports:
      - "86:86"
    command: sh -c "npm install && npm run build && npm run start"
    networks:
      internal:

  nintendo-wiki:
    image: node:18-alpine
    restart: no
    working_dir: /app
    volumes:
      - ./repos/nintendo-wiki:/app 
      - /app/node_modules
    ports:
      - "87:87"
    command: sh -c "npm install && npm run start"
    networks:
      internal:

  website:
    image: node:20-alpine
    restart: no
    working_dir: /app
    volumes:
      - ./repos/website:/app 
      - /app/node_modules
      - .:/usr/src/app
    ports:
      - "82:82"
    command: sh -c "npm install && npm run start"
    networks:
      internal:

  mitmproxy-retendo:
    image: mitmproxy/mitmproxy:latest
    # build: ./repos/mitmproxy-retendo
    restart: no
    ports:
      - 8080:8080
      - 127.0.0.1:8081:8081
    volumes:
      - type: volume
        source: mitmproxy-retendo-data
        target: /home/mitmproxy/.mitmproxy
    command: mitmweb --web-host 0.0.0.0
    tty: true

volumes:
  mitmproxy-retendo-data:

networks:
  internal:
    driver: bridge